<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <button id="btn1">btn1</button>

    <script>
        let obj = { //定义ajax参数格式
            type: '',
            url: '',
            data: {}
        }
        let ajax = function (obj) {
            return new Promise((resolve, reject) => {
                obj["type"] = obj["type"].toUpperCase();
                let xhr = new XMLHttpRequest();
                if (obj.type === 'GET') {
                    xhr.open('GET', obj.url, true);
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState == 4 && xhr.status == 200 || xhr.status == 304) {
                            return resolve(xhr.responseText);
                        } else if (xhr.status != 200 && xhr.status != 304) {
                            return reject(xhr.responseText);
                        }
                    };
                    try {
                        xhr.send();
                    } catch (err) {
                        throw new Error('cross-origin-read-blocking' + err);
                    }
                } else if (obj.type === 'POST') {
                    xhr.open("POST", 'http://localhost:3000/api' + obj.url, true);
                    xhr.setRequestHeader("Content-Type", "application/json;charset=utf-8");
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState == 4 && xhr.status == 200 || xhr.status == 304) {
                            return resolve(xhr.responseText);
                        } else if (xhr.status != 200 && xhr.status != 304) {
                            return reject(xhr.statusText);
                        }
                    };
                    obj.data = JSON.stringify(obj.data);
                    try {
                        xhr.send(obj.data);
                    } catch (err) {
                        throw new Error('cross-origin-resorce-blocking' + err);
                    }
                }
            });
        }

        function hello(data) {
            console.log('aaa', data, typeof data)
        };
        document.getElementById('btn1').onclick = function () {
            ajax({
                type: 'get',
                url: 'http:127.0.0.1:3000/cors',
                data: {
                    a: 1
                }
            }).then(function () {

            }).catch(err => {
                console.log(err);
            })
        }
    </script>
    <script src="http:127.0.0.1:3000/cors?callback=hello"></script>
</body>

</html>